#!/usr/bin/env bash
####################
# THis script transcodes the TV stream from MPEG2 to AVC.  It passes the output
# into a pipe using an MPEGTS format.  
######################################

cd "$(dirname "$0")"

MYPIPE="/tmp/localnewspipe"

if [[ -f $MYPIPE ]]
then
	echo "Pipe Already exists"
else
	mkfifo $MYPIPE
fi

ffmpeg \
    -y \
    -loglevel error \
    -i http://HDHR-10685C23.lan:5004/auto/v2.1 \
    -t 300 \
    -num_capture_buffers 64 \
    -c:a aac \
    -ac 2 \
    -c:v h264_v4l2m2m \
    -b:v 5M \
    -f mpegts \
    pipe: > $MYPIPE

